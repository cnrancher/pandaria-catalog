## Rancher Charts CN

This repository contains Helm charts served by Pandaria Apps & Marketplace.

> Handbook (Chinese)：[pandaria-catalog 仓库维护手册](docs/pandaria-catalog_zh_CN.md)

### Branches

- `dev/v2.X` branches contain charts that under active development, to be released in an upcoming release.
- `release/v2.X` branches contain charts that have already been developed, tested and released.

### File structure

- `assets/` the `tgz` files generated by `make charts` and icon files.
- `charts/` the chart code generated by `make charts` command.
- `packages/` stores packages.
- `docs/` the document of `charts-build-scripts`.

### Add new package to this repo

Add new package generally involves these steps.

Firstly, create `package.yaml` into the package folder.
```
export PACKAGE=<packageName> # can be nested, e.g. rancher-monitoring/rancher-windows-exporter is acceptable
mkdir -p packages/${PACKAGE}
touch packages/${PACKAGE}/package.yaml
```

And write these configurations into `package.yaml`.

```
url: local              # Do not download the chart code from internet.
workingDir: "v0.0.9"    # Directory of the chart code
                        # This repo use the version code `va.b.c` as the folder name
                        # of the chart code for storing the different versions of
                        # charts in same package.
version: 0.0.9          # Version of the chart.
```

### Making changes to existing packages

Since this repository uses [`rancher/charts-build-scripts`](https://github.com/rancher/charts-build-scripts), making changes to this repository involves three steps:
1. Adding or modifying an existing `Package` tracked in the `packages/` directory. Use `export PACKAGE={PACKAGE_NAME}` to specify the modified package name. Then involves `make prepare`, `make patch`, and `make clean` if `url` in `package.yaml` isn't `local`.
1. Running `make charts` to automatically generate assets used to serve a Helm repository (`charts/`, `assets/`, and `index.yaml`) based on the contents of `packages/`.
1. [CI] Running `make validate` to ensure that all generated assets are up-to-date and ready to be merged.

For more information about add/change packages, see [Developing](docs/developing.md).

### Validation / CI

Please execute `make validate` before making a pull request to make sure the CI pipeline passed successfully.
For more information about `make validate`, see [Validation](docs/validation.md).

### Version

Since `charts-build-script` requires semantic version, the `version` in `Chart.yaml` should not start with `v`:

```
version: 1.2.3    # valid
version: v1.2.3   # invalid
```

### License

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

[http://www.apache.org/licenses/LICENSE-2.0](http://www.apache.org/licenses/LICENSE-2.0)

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.